<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototipo Kardex - BeePayroll</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.271.0/dist/umd/lucide.js"></script>

    <!-- Alpine.js Core -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <script defer>
        document.addEventListener('alpine:init', () => {
            Alpine.data('kardexApp', () => ({
                // --- STATE ---
                showFullInfo: false,
                activeProfileTab: 'datos-personales',
                activeAuditTab: 'historico',
                creditFilter: 'todos',
                expandedEventId: null,
                selectedReceipts: [],
                showPoliciesModal: false,
                showAddVacationModal: false,
                showInasistenciaModal: false,
                showPermisoModal: false,
                showIncapacidadModal: false,
                newIncapacidad: {
                    trabajadorSearch: '',
                    trabajadorId: '',
                    showTrabajadorDropdown: false,
                    numeroIncapacidad: '',
                    tipoIncapacidad: 'Enfermedad General',
                    subtipoRiesgo: 'Accidente de Trabajo',
                    fechaInicio: '',
                    diasIncapacidad: '',
                    fechaTermino: '',
                    fechaExpedicion: '',
                    modoIncapacidad: 'Inicial'
                },
                newPermiso: {
                    tipo: 'Permiso',
                    subTipo: 'Permiso sin goce de sueldo',
                    fechaInicio: '',
                    fechaTermino: '',
                    inicioFechaAplicacion: '',
                    activarSuplencia: false,
                    colaboradorSuplente: '',
                    comentario: ''
                },
                newInasistencia: {
                    tipo: 'Inasistencia',
                    fechaInicio: '',
                    fechaTermino: '',
                    inicioFechaAplicacion: '',
                    activarSuplencia: false,
                    colaboradorSuplente: '',
                    comentario: ''
                },
                newVacation: {
                    startDate: '',
                    endDate: '',
                    lastVacationPeriod: '15/06/2025 al 21/06/2025',
                    hasReplacement: false,
                    replacementEmployee: '',
                    comments: ''
                },
                payrollFilters: {
                    startDate: '',
                    endDate: '',
                    status: 'all'
                },
                auditLogPage: 1,
                auditLogItemsPerPage: 5,
                auditFilters: {
                    startDate: '',
                    endDate: '',
                    description: ''
                },
                historicoFilters: {
                    startDate: '',
                    endDate: '',
                    usuario: 'all'
                },
                trajectoryFilters: {
                    startDate: '',
                    endDate: ''
                },
                eventosFilters: {
                    startDate: '',
                    endDate: ''
                },
                eventosPage: 1,
                eventosItemsPerPage: 10,

                // --- COMPUTED ---
                get filteredPayrollHistory() {
                    if (!this.payrollHistory) return [];
                    return this.payrollHistory.filter(receipt => {
                        const statusMatch = this.payrollFilters.status === 'all' || receipt.status === this.payrollFilters.status;
                        
                        if (!this.payrollFilters.startDate || !this.payrollFilters.endDate) {
                            return statusMatch;
                        }

                        const receiptDate = new Date(receipt.payDate.split('/').reverse().join('-'));
                        const startDate = new Date(this.payrollFilters.startDate);
                        const endDate = new Date(this.payrollFilters.endDate);
                        
                        return statusMatch && receiptDate >= startDate && receiptDate <= endDate;
                    });
                },
                get filteredAuditLog() {
                    if (!this.auditLog) return [];
                    return this.auditLog.filter(log => {
                        // Filtro por descripción
                        const descriptionMatch = !this.auditFilters.description || 
                            log.description.toLowerCase().includes(this.auditFilters.description.toLowerCase());
                        
                        // Si no hay fechas, solo aplicar filtro de descripción
                        if (!this.auditFilters.startDate || !this.auditFilters.endDate) {
                            return descriptionMatch;
                        }

                        // Filtro por fechas
                        const logDate = new Date(log.date.split('/').reverse().join('-'));
                        const startDate = new Date(this.auditFilters.startDate);
                        const endDate = new Date(this.auditFilters.endDate);
                        
                        return descriptionMatch && logDate >= startDate && logDate <= endDate;
                    });
                },
                get totalAuditPages() {
                    return Math.ceil(this.filteredAuditLog.length / this.auditLogItemsPerPage);
                },
                get paginatedAuditLog() {
                    const start = (this.auditLogPage - 1) * this.auditLogItemsPerPage;
                    const end = start + this.auditLogItemsPerPage;
                    return this.filteredAuditLog.slice(start, end);
                },
                get vacationDays() {
                    if (!this.newVacation.startDate || !this.newVacation.endDate) return 0;
                    const startDate = new Date(this.newVacation.startDate);
                    const endDate = new Date(this.newVacation.endDate);
                    const timeDiff = endDate.getTime() - startDate.getTime();
                    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
                    return daysDiff > 0 ? daysDiff : 0;
                },
                get inasistenciaDays() {
                    if (!this.newInasistencia.fechaInicio || !this.newInasistencia.fechaTermino) return 0;
                    const startDate = new Date(this.newInasistencia.fechaInicio);
                    const endDate = new Date(this.newInasistencia.fechaTermino);
                    const timeDiff = endDate.getTime() - startDate.getTime();
                    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
                    return daysDiff > 0 ? daysDiff : 0;
                },
                get permisoDays() {
                    if (!this.newPermiso.fechaInicio || !this.newPermiso.fechaTermino) return 0;
                    const startDate = new Date(this.newPermiso.fechaInicio);
                    const endDate = new Date(this.newPermiso.fechaTermino);
                    const timeDiff = endDate.getTime() - startDate.getTime();
                    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
                    return daysDiff > 0 ? daysDiff : 0;
                },
                get calculatedEndDate() {
                    if (!this.newIncapacidad.fechaInicio || !this.newIncapacidad.diasIncapacidad) return '';
                    const startDate = new Date(this.newIncapacidad.fechaInicio);
                    const days = parseInt(this.newIncapacidad.diasIncapacidad) - 1; // -1 porque el primer día cuenta
                    startDate.setDate(startDate.getDate() + days);
                    return startDate.toISOString().split('T')[0];
                },
                get filteredTimelineEvents() {
                    if (!this.timelineEvents) return [];
                    return this.timelineEvents.filter(event => {
                        // Si no hay fechas, mostrar todos
                        if (!this.trajectoryFilters.startDate || !this.trajectoryFilters.endDate) {
                            return true;
                        }

                        // Filtro por fechas únicamente
                        const eventDateStr = event.date;
                        // Convertir "01 de Junio, 2025" a "2025-06-01"
                        const months = {
                            'Enero': '01', 'Febrero': '02', 'Marzo': '03', 'Abril': '04',
                            'Mayo': '05', 'Junio': '06', 'Julio': '07', 'Agosto': '08',
                            'Septiembre': '09', 'Octubre': '10', 'Noviembre': '11', 'Diciembre': '12'
                        };
                        
                        const parts = eventDateStr.split(' ');
                        const day = parts[0].padStart(2, '0');
                        const month = months[parts[2].replace(',', '')];
                        const year = parts[3];
                        
                        if (!month) return true; // Si no puede parsear la fecha, mostrar el evento
                        
                        const eventDate = new Date(`${year}-${month}-${day}`);
                        const startDate = new Date(this.trajectoryFilters.startDate);
                        const endDate = new Date(this.trajectoryFilters.endDate);
                        
                        return eventDate >= startDate && eventDate <= endDate;
                    });
                },
                get filteredTrabajadores() {
                    if (!this.newIncapacidad.trabajadorSearch || this.newIncapacidad.trabajadorSearch.length < 2) return [];
                    const searchTerm = this.newIncapacidad.trabajadorSearch.toLowerCase();
                    return this.trabajadores.filter(trabajador => 
                        trabajador.nombre.toLowerCase().includes(searchTerm) ||
                        trabajador.puesto.toLowerCase().includes(searchTerm) ||
                        trabajador.departamento.toLowerCase().includes(searchTerm)
                    ).slice(0, 5); // Limitar a 5 resultados
                },
                get filteredHistoricoData() {
                    if (!this.historicoData) return [];
                    return this.historicoData.filter(item => {
                        // Filtro por usuario
                        const usuarioMatch = this.historicoFilters.usuario === 'all' || item.usuario === this.historicoFilters.usuario;
                        
                        // Si no hay fechas, solo aplicar filtro de usuario
                        if (!this.historicoFilters.startDate || !this.historicoFilters.endDate) {
                            return usuarioMatch;
                        }

                        // Filtro por fechas - convertir fecha del item a formato comparable
                        const itemDate = new Date(item.fecha.split('/').reverse().join('-'));
                        const startDate = new Date(this.historicoFilters.startDate);
                        const endDate = new Date(this.historicoFilters.endDate);
                        
                        return usuarioMatch && itemDate >= startDate && itemDate <= endDate;
                    });
                },
                get filteredCreditos() {
                    if (!this.creditosData) return [];
                    if (this.creditFilter === 'todos') return this.creditosData;
                    return this.creditosData.filter(credito => credito.tipo === this.creditFilter);
                },
                get filteredEventosCreditos() {
                    if (!this.eventosCreditos) return [];
                    let filtered = this.eventosCreditos;
                    
                    // Filtro por categoría
                    if (this.creditFilter !== 'todos') {
                        filtered = filtered.filter(evento => evento.categoria === this.creditFilter);
                    }
                    
                    // Filtro por fechas
                    if (this.eventosFilters.startDate || this.eventosFilters.endDate) {
                        filtered = filtered.filter(evento => {
                            if (!this.eventosFilters.startDate && !this.eventosFilters.endDate) return true;
                            
                            const eventoDate = new Date(evento.fecha);
                            
                            if (this.eventosFilters.startDate && this.eventosFilters.endDate) {
                                const startDate = new Date(this.eventosFilters.startDate);
                                const endDate = new Date(this.eventosFilters.endDate);
                                return eventoDate >= startDate && eventoDate <= endDate;
                            } else if (this.eventosFilters.startDate) {
                                const startDate = new Date(this.eventosFilters.startDate);
                                return eventoDate >= startDate;
                            } else if (this.eventosFilters.endDate) {
                                const endDate = new Date(this.eventosFilters.endDate);
                                return eventoDate <= endDate;
                            }
                            
                            return true;
                        });
                    }
                    
                    return filtered;
                },
                get totalEventosPages() {
                    return Math.ceil(this.filteredEventosCreditos.length / this.eventosItemsPerPage);
                },
                get paginatedEventosCreditos() {
                    const start = (this.eventosPage - 1) * this.eventosItemsPerPage;
                    const end = start + this.eventosItemsPerPage;
                    return this.filteredEventosCreditos.slice(start, end);
                },

                // --- DATA ---
                employee: {
                    name: 'ANTONIO SANCHEZ AQUIQUE',
                    hireDate: '19/04/2024',
                    address: 'Calle Falsa 123, Colonia Centro, Ciudad de México, CP 06000',
                    phone: '55 1234 5678',
                    email: 'antonio.sanchez@example.com',
                    contractType: 'Contrato de trabajo por tiempo indeterminado',
                    salary: '$551.25',
                    bankAccount: '...6789',
                    curp: 'SAAA741128HDFNQN04',
                    rfc: 'SAAA741128CT4',
                    nss: '39997418715',
                    birthDate: '28/11/1974',
                    gender: 'Masculino',
                    maritalStatus: 'Soltero(a)',
                    systemId: 'CDMX48690',
                    seniorityDate: '19/04/2024',
                    workdayType: 'Diurna',
                    avatar: 'https://placehold.co/100x100/E0E7FF/4338CA?text=AS'
                },
                employeeBankData: {
                    banco: 'BBVA México',
                    numeroCuenta: '0123456789',
                    clabe: '012180001234567890',
                    tipoMovimiento: 'Depósito',
                    metodoPago: 'Transferencia bancaria'
                },
                employeeDeducciones: [
                    { concepto: 'Préstamo personal', monto: '$2,500.00', tipo: 'Fijo', activo: true },
                    { concepto: 'Seguro de vida', monto: '$350.00', tipo: 'Fijo', activo: true },
                    { concepto: 'Fondo de ahorro', monto: '$1,200.00', tipo: 'Porcentual', activo: true },
                    { concepto: 'Cuota sindical', monto: '$180.00', tipo: 'Fijo', activo: false }
                ],
                profileTabs: [
                    { id: 'datos-personales', name: 'Datos Personales' },
                    { id: 'datos-laborales', name: 'Datos Laborales' },
                    { id: 'datos-bancarios', name: 'Datos Bancarios' },
                    { id: 'deducciones', name: 'Deducciones' }
                ],
                auditTabs: [
                    { id: 'historico', name: 'Historico de modificaciones' },
                    { id: 'acciones', name: 'Acciones de usuario' }
                ],
                creditosData: [
                    {
                        id: 1,
                        tipo: 'INFONAVIT',
                        titulo: 'Crédito Hipotecario INFONAVIT',
                        numeroCredito: 'INF-2024-001234',
                        acreedor: 'INFONAVIT',
                        concepto: 'Crédito hipotecario',
                        montoOriginal: '$450,000.00',
                        saldoActual: '$385,250.00',
                        descuentoMensual: '$2,850.00',
                        fechaInicio: '15/01/2024',
                        status: 'Activo',
                        beneficiario: null,
                        parentesco: null,
                        porcentaje: null
                    },
                    {
                        id: 2,
                        tipo: 'FONACOT',
                        titulo: 'Crédito FONACOT',
                        numeroCredito: 'FON-2024-567890',
                        acreedor: 'FONACOT',
                        concepto: 'Crédito personal',
                        montoOriginal: '$25,000.00',
                        saldoActual: '$18,750.00',
                        descuentoMensual: '$1,250.00',
                        fechaInicio: '10/03/2024',
                        status: 'Activo',
                        beneficiario: null,
                        parentesco: null,
                        porcentaje: null
                    },
                    {
                        id: 3,
                        tipo: 'Pensión',
                        titulo: 'Pensión Alimenticia',
                        numeroCredito: 'PENS-2023-001',
                        acreedor: 'Juzgado Familiar',
                        concepto: 'Pensión alimenticia',
                        montoOriginal: null,
                        saldoActual: null,
                        descuentoMensual: '$4,500.00',
                        fechaInicio: '01/06/2023',
                        status: 'Activo',
                        beneficiario: 'María Sánchez López',
                        parentesco: 'Ex-cónyuge',
                        porcentaje: '30%'
                    },
                    {
                        id: 4,
                        tipo: 'Terceros',
                        titulo: 'Préstamo Personal Banco Azteca',
                        numeroCredito: 'BA-2024-789123',
                        acreedor: 'Banco Azteca',
                        concepto: 'Préstamo personal',
                        montoOriginal: '$15,000.00',
                        saldoActual: '$8,900.00',
                        descuentoMensual: '$750.00',
                        fechaInicio: '20/02/2024',
                        status: 'Activo',
                        beneficiario: null,
                        parentesco: null,
                        porcentaje: null
                    },
                    {
                        id: 5,
                        tipo: 'Terceros',
                        titulo: 'Tarjeta de Crédito Coppel',
                        numeroCredito: 'COP-2024-456789',
                        acreedor: 'Coppel',
                        concepto: 'Tarjeta de crédito',
                        montoOriginal: '$8,000.00',
                        saldoActual: '$3,200.00',
                        descuentoMensual: '$400.00',
                        fechaInicio: '15/04/2024',
                        status: 'Activo',
                        beneficiario: null,
                        parentesco: null,
                        porcentaje: null
                    },
                    {
                        id: 6,
                        tipo: 'Terceros',
                        titulo: 'Caja de Ahorro',
                        numeroCredito: 'CA-2024-123456',
                        acreedor: 'Caja de Ahorro Empresa',
                        concepto: 'Ahorro empresarial',
                        montoOriginal: null,
                        saldoActual: '$12,500.00',
                        descuentoMensual: '$500.00',
                        fechaInicio: '01/01/2024',
                        status: 'Activo',
                        beneficiario: null,
                        parentesco: null,
                        porcentaje: null
                    },
                    {
                        id: 7,
                        tipo: 'Terceros',
                        titulo: 'Fondo de Ahorro',
                        numeroCredito: 'FA-2024-789012',
                        acreedor: 'Fondo de Ahorro Corporativo',
                        concepto: 'Ahorro corporativo',
                        montoOriginal: null,
                        saldoActual: '$8,750.00',
                        descuentoMensual: '$350.00',
                        fechaInicio: '15/02/2024',
                        status: 'Activo',
                        beneficiario: null,
                        parentesco: null,
                        porcentaje: null
                    },
                    {
                        id: 8,
                        tipo: 'Terceros',
                        titulo: 'Lentes Devlyn',
                        numeroCredito: 'DEV-2024-345678',
                        acreedor: 'Ópticas Devlyn',
                        concepto: 'Crédito óptico',
                        montoOriginal: '$3,500.00',
                        saldoActual: '$2,100.00',
                        descuentoMensual: '$175.00',
                        fechaInicio: '10/05/2024',
                        status: 'Activo',
                        beneficiario: null,
                        parentesco: null,
                        porcentaje: null
                    }
                ],
                historicoData: [
                    { id: 1, campo: 'Salario Diario', valorAnterior: '$551.25', valorActualizado: '$600.00', usuario: 'Laura Méndez', fecha: '02/08/2025', hora: '10:05:30' },
                    { id: 2, campo: 'Domicilio', valorAnterior: 'Calle Antigua 456', valorActualizado: 'Calle Falsa 123', usuario: 'Eduardo Castillo', fecha: '04/08/2025', hora: '16:45:10' },
                    { id: 3, campo: 'Estado', valorAnterior: 'Inactivo', valorActualizado: 'Activo', usuario: 'Eduardo Castillo', fecha: '01/08/2025', hora: '14:23:14' },
                    { id: 4, campo: 'Puesto', valorAnterior: 'Analista de Nómina', valorActualizado: 'Analista Senior de Nómina', usuario: 'Laura Méndez', fecha: '01/06/2025', hora: '09:15:22' },
                    { id: 5, campo: 'Teléfono', valorAnterior: '55 9876 5432', valorActualizado: '55 1234 5678', usuario: 'Eduardo Castillo', fecha: '03/08/2025', hora: '11:30:45' }
                ],
                timelineEvents: [
                    {
                        id: 4,
                        date: '01 de Junio, 2025',
                        title: 'Cambio de salario',
                        summary: 'Promoción de Analista de Nómina a Analista Senior de Nómina.',
                        icon: 'award',
                        type: 'Movimiento IMSS',
                        registroPatronal: 'A1234567890',
                        loteId: 'LT-2025-06-001',
                        before: '<strong>Puesto:</strong> Analista de Nómina<br><strong>Salario Diario:</strong> $600.00',
                        after: '<strong>Puesto:</strong> Analista Senior de Nómina<br><strong>Salario Diario:</strong> $750.00'
                    },
                    {
                        id: 3,
                        date: '19 de Abril, 2025',
                        title: 'Cambio de salario',
                        summary: 'El trabajador cumplió su primer año en la compañía.',
                        icon: 'cake',
                        type: 'Movimiento IMSS',
                        registroPatronal: 'A1234567890',
                        loteId: 'LT-2025-04-002',
                        before: '<strong>Antigüedad:</strong> 0 años',
                        after: '<strong>Antigüedad:</strong> 1 año'
                    },
                    {
                        id: 1,
                        date: '01 de Enero, 2025',
                        title: 'Cambio Salarial',
                        summary: 'Ajuste salarial por desempeño.',
                        icon: 'trending-up',
                        type: 'Movimiento IMSS',
                        registroPatronal: 'A1234567890',
                        loteId: 'LT-2025-01-003',
                        before: '<strong>Salario Diario:</strong> $551.25',
                        after: '<strong>Salario Diario:</strong> $600.00'
                    },
                    {
                        id: 2,
                        date: '19 de Abril, 2024',
                        title: 'Alta trabajador',
                        summary: 'Ingreso a la compañía como Analista de Nómina.',
                        icon: 'briefcase',
                        type: 'Movimiento IMSS',
                        registroPatronal: 'A1234567890',
                        loteId: 'LT-2024-04-001',
                        before: 'N/A',
                        after: '<strong>Puesto:</strong> Analista de Nómina<br><strong>Salario Diario:</strong> $551.25'
                    }
                ],
                payrollHistory: [
                    { 
                        id: 1, 
                        period: '1ra Quincena Julio 2025', 
                        payDate: '15/07/2025', 
                        netAmount: '$8,580.50', 
                        status: 'Timbrado',
                        percepciones: '$9,125.75',
                        deducciones: '$1,545.25'
                    },
                    { 
                        id: 2, 
                        period: '2da Quincena Junio 2025', 
                        payDate: '30/06/2025', 
                        netAmount: '$8,550.00', 
                        status: 'Timbrado',
                        percepciones: '$9,085.50',
                        deducciones: '$1,535.50'
                    },
                    { 
                        id: 3, 
                        period: '1ra Quincena Junio 2025', 
                        payDate: '15/06/2025', 
                        netAmount: '$8,550.00', 
                        status: 'Timbrado',
                        percepciones: '$9,085.50',
                        deducciones: '$1,535.50'
                    },
                    { 
                        id: 4, 
                        period: '2da Quincena Mayo 2025', 
                        payDate: '31/05/2025', 
                        netAmount: '$0.00', 
                        status: 'Cancelado',
                        percepciones: '$8,950.00',
                        deducciones: '$8,950.00'
                    },
                    { 
                        id: 5, 
                        period: '1ra Quincena Mayo 2025', 
                        payDate: '15/05/2025', 
                        netAmount: '$8,550.00', 
                        status: 'Timbrado',
                        percepciones: '$9,085.50',
                        deducciones: '$1,535.50'
                    },
                ],
                digitalFile: [
                    { id: 1, name: 'Contrato de Trabajo.pdf' },
                    { id: 2, name: 'Identificación Oficial (INE).pdf' },
                    { id: 3, name: 'Constancia de Situación Fiscal.pdf' },
                    { id: 4, name: 'Comprobante de Domicilio.pdf' },
                    { id: 5, name: 'CURP.pdf' },
                ],
                attendanceHistory: [
                    { id: 1, type: 'Día de cumpleaños', startDate: '13-08-2025', endDate: '13-08-2025', days: 1, status: 'Aprobado' },
                    { id: 2, type: 'Inasistencia', startDate: '22-07-2025', endDate: '22-07-2025', days: 1, status: 'Aprobado' },
                    { id: 3, type: 'Permiso con goce', startDate: '10-07-2025', endDate: '10-07-2025', days: 1, status: 'Aprobado' },
                    { id: 4, type: 'Incapacidad', startDate: '09-07-2025', endDate: '09-07-2025', days: 1, status: 'Aprobado' },
                ],
                vacationPolicies: [
                    { years: 1.0, days: 12, prima: 0.25, aguinaldo: 15},
                    { years: 2.0, days: 14, prima: 0.25, aguinaldo: 15},
                    { years: 3.0, days: 16, prima: 0.25, aguinaldo: 15},
                    { years: 4.0, days: 18, prima: 0.25, aguinaldo: 15},
                    { years: 5.0, days: 20, prima: 0.25, aguinaldo: 15},
                    { years: '6.0 - 10.0', days: 22, prima: 0.25, aguinaldo: 15},
                    { years: '11.0 - 15.0', days: 24, prima: 0.25, aguinaldo: 15},
                ],
                auditLog: [
                    { id: 1, description: 'Creó nuevo trabajador con ID 15078', user: 'Eduardo Castillo', role: 'Administrador', date: '01/08/2025', time: '14:23:14', valueBefore: '-', valueAfter: 'ID: 15078', endpoint: '/api/users/new/1754', ip: '192.168.56.82' },
                    { id: 2, description: 'Modificó salario de trabajador ID 15078', user: 'Laura Méndez', role: 'Nómina', date: '02/08/2025', time: '10:05:30', valueBefore: '$551.25', valueAfter: '$600.00', endpoint: '/api/users/1754/salary', ip: '192.168.56.88' },
                    { id: 3, description: 'Descargó recibo de nómina Q15 Julio', user: 'ANTONIO SANCHEZ AQUIQUE', role: 'Empleado', date: '02/08/2025', time: '11:15:01', valueBefore: '-', valueAfter: '-', endpoint: '/api/paystubs/download/123', ip: '200.5.8.1' },
                    { id: 4, description: 'Aprobó solicitud de vacaciones', user: 'Jefe Inmediato', role: 'Gerente', date: '03/08/2025', time: '09:30:00', valueBefore: 'Pendiente', valueAfter: 'Aprobada', endpoint: '/api/vacations/approve/45', ip: '192.168.56.91' },
                    { id: 5, description: 'Actualizó domicilio de trabajador ID 15078', user: 'Eduardo Castillo', role: 'Administrador', date: '04/08/2025', time: '16:45:10', valueBefore: 'Calle Antigua 456', valueAfter: 'Calle Falsa 123', endpoint: '/api/users/1754/address', ip: '192.168.56.82' },
                    { id: 6, description: 'Generó reporte de auditoría', user: 'Eduardo Castillo', role: 'Administrador', date: '05/08/2025', time: '12:00:00', valueBefore: '-', valueAfter: '-', endpoint: '/api/reports/audit', ip: '192.168.56.82' },
                ],
                trabajadores: [
                    { id: 1, nombre: 'ANTONIO SANCHEZ AQUIQUE', puesto: 'Analista de Nómina', departamento: 'Recursos Humanos' },
                    { id: 2, nombre: 'Ana Eugenia Reyes Castellanos', puesto: 'Coordinadora', departamento: 'Finanzas' },
                    { id: 3, nombre: 'Victoria Castro Rojas', puesto: 'Asistente', departamento: 'Administración' },
                    { id: 4, nombre: 'Juan Pérez García', puesto: 'Desarrollador', departamento: 'Tecnología' },
                    { id: 5, nombre: 'María García López', puesto: 'Contadora', departamento: 'Finanzas' },
                    { id: 6, nombre: 'Carlos Rodríguez Martín', puesto: 'Gerente', departamento: 'Ventas' },
                    { id: 7, nombre: 'Laura Méndez Torres', puesto: 'Analista', departamento: 'Recursos Humanos' },
                    { id: 8, nombre: 'Pedro Morales Silva', puesto: 'Supervisor', departamento: 'Operaciones' },
                    { id: 9, nombre: 'Ana Prueba X', puesto: 'Especialista', departamento: 'Marketing' },
                    { id: 10, nombre: 'Roberto Jiménez Cruz', puesto: 'Técnico', departamento: 'Soporte' }
                ],
                eventosCreditos: [
                    {
                        id: 1,
                        fecha: '2024-01-15',
                        hora: '10:30:15',
                        evento: 'Creación de Crédito',
                        categoria: 'INFONAVIT',
                        detalle: 'Se registra crédito INF-2024-001234. Tipo: Cuota Fija, Valor: $2,850.00. Monto original: $450,000.00. Origen: Aviso de Retención.',
                        usuario: 'admin@empresa.com',
                        tipo: 'registro'
                    },
                    {
                        id: 2,
                        fecha: '2024-01-31',
                        hora: '18:00:00',
                        evento: 'Aplicación de Deducción',
                        categoria: 'INFONAVIT',
                        detalle: 'Descuento de $2,850.00 aplicado en nómina Q2-ENE. Saldo anterior: $450,000.00, Saldo nuevo: $447,150.00.',
                        usuario: 'Sistema (Nómina)',
                        tipo: 'aplicacion'
                    },
                    {
                        id: 3,
                        fecha: '2025-02-01',
                        hora: '11:00:00',
                        evento: 'Modificación de Crédito',
                        categoria: 'INFONAVIT',
                        detalle: 'Cambio de tipo de descuento. Anterior: Cuota Fija, Nuevo: Veces UMI. Valor anterior: $2,850.00, Valor nuevo: 27.1. Origen: Aviso de Modificación.',
                        usuario: 'rrhh@empresa.com',
                        tipo: 'modificacion'
                    },
                    {
                        id: 4,
                        fecha: '2024-03-10',
                        hora: '14:15:00',
                        evento: 'Creación de Crédito',
                        categoria: 'FONACOT',
                        detalle: 'Se registra crédito FONACOT 12345. Monto total: $24,000.00. Descuento por periodo: $1,000.00.',
                        usuario: 'admin@empresa.com',
                        tipo: 'registro'
                    },
                    {
                        id: 5,
                        fecha: '2023-06-01',
                        hora: '16:30:00',
                        evento: 'Creación de Retención',
                        categoria: 'Pensión',
                        detalle: 'Se registra retención por Pensión Alimenticia. Expediente: JZF-123/2024. Fórmula: (Ingresos Gravables - ISR - IMSS) * 30%.',
                        usuario: 'admin@empresa.com',
                        tipo: 'registro'
                    },
                    {
                        id: 6,
                        fecha: '2024-02-20',
                        hora: '12:45:00',
                        evento: 'Creación de Crédito',
                        categoria: 'Terceros',
                        detalle: 'Se registra préstamo personal Banco Azteca con No. BA-2024-789123, Valor: $750.00.',
                        usuario: 'admin@empresa.com',
                        tipo: 'registro'
                    },
                    {
                        id: 7,
                        fecha: '2028-07-15',
                        hora: '18:00:00',
                        evento: 'Liquidación de Crédito',
                        categoria: 'FONACOT',
                        detalle: 'El saldo ha llegado a cero. El crédito se marca como liquidado y se desactiva.',
                        usuario: 'Sistema (Nómina)',
                        tipo: 'liquidacion'
                    },
                    {
                        id: 8,
                        fecha: '2024-05-15',
                        hora: '14:30:00',
                        evento: 'Abono Extraordinario',
                        categoria: 'INFONAVIT',
                        detalle: 'Se registra abono extraordinario por $5,000.00. Saldo anterior: $385,250.00, Saldo nuevo: $380,250.00.',
                        usuario: 'admin@empresa.com',
                        tipo: 'abono'
                    },
                    {
                        id: 9,
                        fecha: '2024-04-10',
                        hora: '10:15:00',
                        evento: 'Aplicación de Deducción',
                        categoria: 'FONACOT',
                        detalle: 'Descuento de $1,000.00 aplicado en nómina Q2-ENE. Saldo anterior: $24,000.00, Saldo nuevo: $23,000.00.',
                        usuario: 'Sistema (Nómina)',
                        tipo: 'aplicacion'
                    },
                    {
                        id: 10,
                        fecha: '2024-06-20',
                        hora: '16:45:00',
                        evento: 'Modificación de Crédito',
                        categoria: 'FONACOT',
                        detalle: 'Se edita el crédito. Campo modificado: Monto Total. Valor anterior: $24,000.00, Valor nuevo: $23,500.00. Motivo: Ajuste administrativo.',
                        usuario: 'rrhh@empresa.com',
                        tipo: 'modificacion'
                    },
                    {
                        id: 11,
                        fecha: '2023-07-15',
                        hora: '11:30:00',
                        evento: 'Aplicación de Retención',
                        categoria: 'Pensión',
                        detalle: 'Retención de $3,570.80 aplicada en nómina Q2-ENE.',
                        usuario: 'Sistema (Nómina)',
                        tipo: 'aplicacion'
                    },
                    {
                        id: 12,
                        fecha: '2024-01-10',
                        hora: '09:20:00',
                        evento: 'Modificación de Retención',
                        categoria: 'Pensión',
                        detalle: 'Se edita la fórmula de retención. Fórmula anterior: (...) * 30%, Fórmula nueva: (...) * 35%. Origen: Nueva orden judicial.',
                        usuario: 'rrhh@empresa.com',
                        tipo: 'modificacion'
                    },
                    {
                        id: 13,
                        fecha: '2024-03-25',
                        hora: '15:10:00',
                        evento: 'Liquidación de Crédito',
                        categoria: 'Terceros',
                        detalle: 'El saldo ha llegado a cero. El crédito se marca como liquidado y se desactiva.',
                        usuario: 'Sistema (Nómina)',
                        tipo: 'liquidacion'
                    },
                    {
                        id: 14,
                        fecha: '2024-01-01',
                        hora: '08:00:00',
                        evento: 'Creación de Ahorro',
                        categoria: 'Terceros',
                        detalle: 'Se registra Caja de Ahorro CA-2024-123456. Aportación mensual: $500.00. Modalidad: Ahorro empresarial.',
                        usuario: 'admin@empresa.com',
                        tipo: 'registro'
                    },
                    {
                        id: 15,
                        fecha: '2024-02-15',
                        hora: '09:30:00',
                        evento: 'Creación de Ahorro',
                        categoria: 'Terceros',
                        detalle: 'Se registra Fondo de Ahorro FA-2024-789012. Aportación mensual: $350.00. Modalidad: Ahorro corporativo.',
                        usuario: 'admin@empresa.com',
                        tipo: 'registro'
                    },
                    {
                        id: 16,
                        fecha: '2024-05-10',
                        hora: '11:15:00',
                        evento: 'Creación de Crédito',
                        categoria: 'Terceros',
                        detalle: 'Se registra crédito Lentes Devlyn DEV-2024-345678. Monto total: $3,500.00. Descuento mensual: $175.00.',
                        usuario: 'admin@empresa.com',
                        tipo: 'registro'
                    },
                    {
                        id: 17,
                        fecha: '2024-01-31',
                        hora: '18:00:00',
                        evento: 'Aplicación de Descuento',
                        categoria: 'Terceros',
                        detalle: 'Aportación de $500.00 aplicada en nómina Q1-ENE para Caja de Ahorro. Saldo acumulado: $500.00.',
                        usuario: 'Sistema (Nómina)',
                        tipo: 'aplicacion'
                    },
                    {
                        id: 18,
                        fecha: '2024-02-29',
                        hora: '18:00:00',
                        evento: 'Aplicación de Descuento',
                        categoria: 'Terceros',
                        detalle: 'Aportación de $350.00 aplicada en nómina Q1-FEB para Fondo de Ahorro. Saldo acumulado: $350.00.',
                        usuario: 'Sistema (Nómina)',
                        tipo: 'aplicacion'
                    },
                    {
                        id: 19,
                        fecha: '2024-05-31',
                        hora: '18:00:00',
                        evento: 'Aplicación de Deducción',
                        categoria: 'Terceros',
                        detalle: 'Descuento de $175.00 aplicado en nómina Q2-MAY para Lentes Devlyn. Saldo anterior: $3,500.00, Saldo nuevo: $3,325.00.',
                        usuario: 'Sistema (Nómina)',
                        tipo: 'aplicacion'
                    }
                ],
                
                // --- METHODS ---
                toggleAllReceipts(event) {
                    if (event.target.checked) {
                        this.selectedReceipts = this.filteredPayrollHistory.map(r => r.id);
                    } else {
                        this.selectedReceipts = [];
                    }
                },
                selectTrabajador(trabajador) {
                    this.newIncapacidad.trabajadorSearch = trabajador.nombre;
                    this.newIncapacidad.trabajadorId = trabajador.id;
                    this.newIncapacidad.showTrabajadorDropdown = false;
                },
                init() {
                    lucide.createIcons();
                    this.$watch('filteredPayrollHistory', () => {
                        this.$nextTick(() => lucide.createIcons());
                    });
                    
                    // Inicializar navegación de secciones
                    this.$nextTick(() => {
                        this.initSectionNavigation();
                    });
                },
                initSectionNavigation() {
                    const navLinks = document.querySelectorAll('.secondary-nav a');
                    const contentSections = document.querySelectorAll('.content-section');

                    navLinks.forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();

                            // Gestionar el estado activo en los links
                            navLinks.forEach(item => item.classList.remove('active'));
                            link.classList.add('active');

                            // Obtener el ID del contenido a mostrar
                            const targetId = link.getAttribute('href').substring(1);
                            
                            // Mostrar/Ocultar las secciones de contenido
                            contentSections.forEach(section => {
                                if (section.id === targetId) {
                                    section.classList.add('active');
                                } else {
                                    section.classList.remove('active');
                                }
                            });
                            
                            // Recrear iconos después del cambio
                            this.$nextTick(() => lucide.createIcons());
                        });
                    });
                }
            }));
        });
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        [x-cloak] { display: none !important; }
        .secondary-nav a:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .secondary-nav a.active {
            background-color: #eef2ff; /* indigo-50 */
            color: #4f46e5; /* indigo-600 */
            font-weight: 600;
            border-right: 3px solid #4f46e5;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .profile-tab-active {
            border-bottom: 3px solid #2563EB;
            color: #2563EB;
            font-weight: 600;
        }
        .profile-tab-inactive {
            border-bottom: 3px solid transparent;
            color: #475569;
        }
        /* Custom scrollbar styles */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-slate-100">

    <div class="flex flex-col h-screen">
        <!-- Top Header Bar -->
        <header class="bg-white border-b border-slate-200 w-full flex-shrink-0">
            <div class="flex items-center justify-between h-16 px-8">
                <div class="flex items-center space-x-4">
                    <button class="text-slate-500"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
                    <span class="text-lg font-bold text-slate-800">Bee Payroll</span>
                </div>
                <div class="flex items-center">
                    <div class="w-9 h-9 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                        A
                    </div>
                </div>
            </div>
        </header>
        
        <div class="flex flex-1 overflow-hidden" x-data="kardexApp" x-init="init()" x-cloak>
            <!-- Main Sidebar (for context) -->
            <aside class="w-64 bg-white shadow-md flex-shrink-0">
                <nav class="p-4 space-y-2 mt-4">
                    <a href="#" class="flex items-center p-2 text-slate-700 rounded-md hover:bg-slate-100"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i> Panel Principal</a>
                    <a href="#" class="flex items-center p-2 text-slate-700 rounded-md hover:bg-slate-100"><i data-lucide="building" class="w-5 h-5 mr-3"></i> Empresa</a>
                    <a href="#" class="flex items-center p-2 bg-blue-100 text-blue-700 font-semibold rounded-md"><i data-lucide="users" class="w-5 h-5 mr-3"></i> Trabajadores</a>
                    <a href="#" class="flex items-center p-2 text-slate-700 rounded-md hover:bg-slate-100"><i data-lucide="file-text" class="w-5 h-5 mr-3"></i> Nóminas</a>
                    <a href="#" class="flex items-center p-2 text-slate-700 rounded-md hover:bg-slate-100"><i data-lucide="bar-chart-3" class="w-5 h-5 mr-3"></i> Reportes</a>
                    <a href="#" class="flex items-center p-2 text-slate-700 rounded-md hover:bg-slate-100"><i data-lucide="settings" class="w-5 h-5 mr-3"></i> Configuración</a>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto">
                <div class="p-8">
                    <!-- Header -->
                    <div class="flex items-start space-x-6">
                        <img :src="employee.avatar" alt="Foto de perfil" class="w-24 h-24 rounded-full border-4 border-white shadow-md">
                        <div class="flex-1">
                            <div>
                                <h1 class="text-2xl font-bold text-slate-800" x-text="`Detalles del trabajador ${employee.name}`"></h1>
                                <p class="text-sm text-slate-500" x-text="`Activo desde: ${employee.hireDate}`"></p>
                                <span class="inline-block mt-2 px-3 py-1 text-sm font-semibold rounded-full bg-green-100 text-green-800">Activo</span>
                            </div>
                        </div>
                    </div>

                    <!-- Alert Boxes -->
                    <div class="mt-6 space-y-3">
                        <div class="bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 p-4 rounded-r-lg flex items-center">
                            <i data-lucide="alert-triangle" class="w-5 h-5 mr-3"></i>
                            <p class="text-sm">El puesto de este trabajador no se encuentra en el listado de puestos por empresa</p>
                        </div>
                    </div>
                    
                    <!-- Contenedor del Perfil (Navegación Secundaria + Contenido) -->
                    <div class="mt-8 flex space-x-8">
                        <!-- Navegación Vertical Secundaria -->
                        <nav class="secondary-nav w-1/4 lg:w-1/5 flex-shrink-0">
                            <div class="space-y-1">
                                <a href="#perfil-general" class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 rounded-lg active">
                                    <i data-lucide="user-circle" class="w-5 h-5 mr-3"></i> Perfil General
                                </a>
                                <a href="#trayectoria" class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 rounded-lg">
                                    <i data-lucide="trending-up" class="w-5 h-5 mr-3"></i> Movimientos IMSS
                                </a>
                                <a href="#nomina" class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 rounded-lg">
                                    <i data-lucide="landmark" class="w-5 h-5 mr-3"></i> CFDIs Nómina
                                </a>
                                <a href="#creditos" class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 rounded-lg">
                                    <i data-lucide="credit-card" class="w-5 h-5 mr-3"></i> Deducciones y créditos
                                </a>
                                <a href="#asistencia" class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 rounded-lg">
                                    <i data-lucide="calendar-check" class="w-5 h-5 mr-3"></i> Asistencia e Incapacidades
                                </a>
                                <a href="#vacaciones" class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 rounded-lg">
                                    <i data-lucide="plane" class="w-5 h-5 mr-3"></i> Gestión de Vacaciones
                                </a>
                                <a href="#documentos" class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 rounded-lg">
                                    <i data-lucide="folder-kanban" class="w-5 h-5 mr-3"></i> Expediente Digital
                                </a>
                                <a href="#auditoria" class="flex items-center px-4 py-2.5 text-sm font-medium text-slate-700 rounded-lg">
                                    <i data-lucide="shield-check" class="w-5 h-5 mr-3"></i> Auditoría
                                </a>
                            </div>
                        </nav>
                        
                        <!-- Contenido de la Sección -->
                        <div class="flex-1">
                            <!-- Pestaña: Perfil General -->
                            <div id="perfil-general" class="content-section active">
                                <!-- Sub-navegación de pestañas para Perfil General -->
                                <nav class="border-b border-slate-200 mb-6">
                                    <div class="flex space-x-8">
                                        <template x-for="tab in profileTabs" :key="tab.id">
                                            <button @click="activeProfileTab = tab.id" 
                                                    :class="activeProfileTab === tab.id ? 'profile-tab-active' : 'profile-tab-inactive'" 
                                                    class="py-3 px-1 text-sm transition-colors duration-200" 
                                                    x-text="tab.name">
                                            </button>
                                        </template>
                                    </div>
                                </nav>

                                <!-- Contenido de las sub-pestañas -->
                                <div>
                                    <!-- Datos Personales -->
                                    <div x-show="activeProfileTab === 'datos-personales'">
                                        <div class="bg-white p-6 rounded-lg shadow-sm">
                                            <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                                                <i data-lucide="user" class="w-5 h-5 mr-3 text-blue-600"></i>
                                                Datos Personales
                                            </h3>
                                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-sm">
                                                <div><strong class="text-slate-500 block">Nombre Completo</strong> <span x-text="employee.name"></span></div>
                                                <div><strong class="text-slate-500 block">CURP</strong> <span x-text="employee.curp"></span></div>
                                                <div><strong class="text-slate-500 block">RFC</strong> <span x-text="employee.rfc"></span></div>
                                                <div><strong class="text-slate-500 block">Fecha de Nacimiento</strong> <span x-text="employee.birthDate"></span></div>
                                                <div><strong class="text-slate-500 block">Género</strong> <span x-text="employee.gender"></span></div>
                                                <div><strong class="text-slate-500 block">Estado Civil</strong> <span x-text="employee.maritalStatus"></span></div>
                                                <div><strong class="text-slate-500 block">Dirección</strong> <span x-text="employee.address"></span></div>
                                                <div><strong class="text-slate-500 block">Teléfono</strong> <span x-text="employee.phone"></span></div>
                                                <div><strong class="text-slate-500 block">Correo Electrónico</strong> <span x-text="employee.email"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Datos Laborales -->
                                    <div x-show="activeProfileTab === 'datos-laborales'">
                                        <div class="bg-white p-6 rounded-lg shadow-sm">
                                            <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                                                <i data-lucide="briefcase" class="w-5 h-5 mr-3 text-blue-600"></i>
                                                Datos Laborales
                                            </h3>
                                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-sm">
                                                <div><strong class="text-slate-500 block">ID Empleado Sistema</strong> <span x-text="employee.systemId"></span></div>
                                                <div><strong class="text-slate-500 block">Fecha de Contratación</strong> <span x-text="employee.hireDate"></span></div>
                                                <div><strong class="text-slate-500 block">Fecha de Antigüedad</strong> <span x-text="employee.seniorityDate"></span></div>
                                                <div><strong class="text-slate-500 block">Tipo de Contrato</strong> <span x-text="employee.contractType"></span></div>
                                                <div><strong class="text-slate-500 block">Tipo de Jornada</strong> <span x-text="employee.workdayType"></span></div>
                                                <div><strong class="text-slate-500 block">Salario Diario</strong> <span x-text="employee.salary"></span></div>
                                                <div><strong class="text-slate-500 block">NSS</strong> <span x-text="employee.nss"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Datos Bancarios -->
                                    <div x-show="activeProfileTab === 'datos-bancarios'">
                                        <div class="bg-white p-6 rounded-lg shadow-sm">
                                            <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                                                <i data-lucide="credit-card" class="w-5 h-5 mr-3 text-blue-600"></i>
                                                Datos Bancarios
                                            </h3>
                                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-sm">
                                                <div><strong class="text-slate-500 block">Banco</strong> <span x-text="employeeBankData.banco"></span></div>
                                                <div><strong class="text-slate-500 block">Número de Cuenta</strong> **** <span x-text="employeeBankData.numeroCuenta.slice(-4)"></span></div>
                                                <div><strong class="text-slate-500 block">CLABE</strong> <span x-text="employeeBankData.clabe"></span></div>
                                                <div><strong class="text-slate-500 block">Tipo de Movimiento</strong> <span x-text="employeeBankData.tipoMovimiento"></span></div>
                                                <div><strong class="text-slate-500 block">Método de Pago</strong> <span x-text="employeeBankData.metodoPago"></span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Deducciones -->
                                    <div x-show="activeProfileTab === 'deducciones'">
                                        <div class="bg-white p-6 rounded-lg shadow-sm">
                                            <div class="flex justify-between items-center mb-4">
                                                <h3 class="text-lg font-bold text-slate-800 flex items-center">
                                                    <i data-lucide="minus-circle" class="w-5 h-5 mr-3 text-blue-600"></i>
                                                    Deducciones
                                                </h3>
                                                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700 transition flex items-center">
                                                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                                    Agregar Deducción
                                                </button>
                                            </div>
                                            <div class="overflow-x-auto">
                                                <table class="w-full text-sm">
                                                    <thead class="text-left text-slate-500 bg-slate-50">
                                                        <tr>
                                                            <th class="p-3 font-semibold">Concepto</th>
                                                            <th class="p-3 font-semibold">Monto</th>
                                                            <th class="p-3 font-semibold">Tipo</th>
                                                            <th class="p-3 font-semibold">Estado</th>
                                                            <th class="p-3 font-semibold text-center">Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <template x-for="deduccion in employeeDeducciones" :key="deduccion.concepto">
                                                            <tr class="border-t border-slate-200">
                                                                <td class="p-3 font-semibold" x-text="deduccion.concepto"></td>
                                                                <td class="p-3" x-text="deduccion.monto"></td>
                                                                <td class="p-3" x-text="deduccion.tipo"></td>
                                                                <td class="p-3">
                                                                    <span class="px-2 py-1 text-xs font-semibold rounded-full"
                                                                          :class="deduccion.activo ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                                                                          x-text="deduccion.activo ? 'Activo' : 'Inactivo'">
                                                                      </span>
                                                                </td>
                                                                <td class="p-3">
                                                                    <div class="flex justify-center space-x-2 text-slate-500">
                                                                        <button class="hover:text-blue-600"><i data-lucide="pencil" class="w-4 h-4"></i></button>
                                                                        <button class="hover:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </template>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pestaña: Movimientos IMSS -->
                            <div id="trayectoria" class="content-section">
                                <!-- Filtros -->
                                <div class="mb-6 p-4 bg-slate-50 rounded-lg border border-slate-200">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="trajectoryStartDate" class="text-xs font-semibold text-slate-600">Fecha de inicio</label>
                                            <input type="date" id="trajectoryStartDate" x-model="trajectoryFilters.startDate" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                        </div>
                                        <div>
                                            <label for="trajectoryEndDate" class="text-xs font-semibold text-slate-600">Fecha de fin</label>
                                            <input type="date" id="trajectoryEndDate" x-model="trajectoryFilters.endDate" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                        </div>
                                    </div>
                                </div>

                                <div class="relative pl-8 border-l-2 border-slate-200">
                                    <template x-for="(event, index) in filteredTimelineEvents" :key="event.id">
                                        <div class="mb-10">
                                            <div class="absolute -left-4 flex items-center justify-center w-8 h-8 bg-blue-600 rounded-full text-white">
                                                <i :data-lucide="event.icon" class="w-5 h-5"></i>
                                            </div>
                                            <div class="bg-white p-5 rounded-lg shadow-sm ml-8">
                                                <p class="text-xs text-slate-500" x-text="event.date"></p>
                                                <h4 class="font-bold mt-1 text-slate-800" x-text="event.title"></h4>
                                                <p class="text-sm text-slate-600 mt-1" x-text="event.summary"></p>
                                                <button @click="expandedEventId = (expandedEventId === event.id ? null : event.id)" class="text-blue-600 text-sm font-semibold mt-3">
                                                    <span x-show="expandedEventId !== event.id">Ver Detalles...</span>
                                                    <span x-show="expandedEventId === event.id">Ocultar Detalles</span>
                                                </button>
                                                <div x-show="expandedEventId === event.id" x-collapse>
                                                    <div class="mt-4 pt-4 border-t border-slate-200 grid grid-cols-2 gap-4 text-sm">
                                                        <div>
                                                            <h5 class="font-semibold text-slate-400 mb-2 text-xs">ANTES</h5>
                                                            <div class="space-y-1"><p x-html="event.before"></p></div>
                                                        </div>
                                                        <div>
                                                            <h5 class="font-semibold text-slate-400 mb-2 text-xs">DESPUÉS</h5>
                                                            <div class="space-y-1"><p x-html="event.after"></p></div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Información IMSS (solo para movimientos IMSS) -->
                                                    <div x-show="event.type === 'Movimiento IMSS'" class="mt-4 pt-4 border-t border-slate-200">
                                                        <h5 class="font-semibold text-slate-700 mb-3 text-sm">Información del Movimiento IMSS</h5>
                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
                                                            <div>
                                                                <span class="font-semibold text-slate-500">Registro Patronal:</span>
                                                                <span class="ml-2 font-mono" x-text="event.registroPatronal"></span>
                                                            </div>
                                                            <div>
                                                                <span class="font-semibold text-slate-500">Lote ID:</span>
                                                                <span class="ml-2 font-mono" x-text="event.loteId"></span>
                                                            </div>
                                                        </div>
                                                        <button class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-green-700 transition flex items-center">
                                                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                                                            Descargar acuse de movimiento afiliatorio
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Pestaña: CFDIs Nómina -->
                            <div id="nomina" class="content-section">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                
                                
                                <!-- Filters and Actions -->
                                <div class="mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200">
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                                        <div>
                                            <label for="startDate" class="text-xs font-semibold text-slate-600">Fecha de inicio</label>
                                            <input type="date" id="startDate" x-model="payrollFilters.startDate" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                        </div>
                                        <div>
                                            <label for="endDate" class="text-xs font-semibold text-slate-600">Fecha de fin</label>
                                            <input type="date" id="endDate" x-model="payrollFilters.endDate" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                        </div>
                                        <div>
                                            <label for="statusFilter" class="text-xs font-semibold text-slate-600">Estado</label>
                                            <select id="statusFilter" x-model="payrollFilters.status" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                                <option value="all">Todos</option>
                                                <option value="Timbrado">Timbrados</option>
                                                <option value="Cancelado">Cancelados</option>
                                            </select>
                                        </div>
                                        <button 
                                            :disabled="selectedReceipts.length === 0" 
                                            class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700 transition flex items-center justify-center disabled:bg-slate-300 disabled:cursor-not-allowed">
                                            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                                            <span x-text="`Descargar ${selectedReceipts.length} timbres`"></span>
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-4 overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="text-left text-slate-500 bg-slate-50">
                                            <tr>
                                                <th class="p-3 w-10 text-center"><input type="checkbox" @change="toggleAllReceipts($event)" class="rounded border-slate-300"></th>
                                                <th class="p-3 font-semibold">Periodo</th>
                                                <th class="p-3 font-semibold">Fecha de Pago</th>
                                                <th class="p-3 font-semibold">Estado</th>
                                                <th class="p-3 font-semibold text-right">Neto Pagado</th>
                                                <th class="p-3 font-semibold text-center">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="receipt in filteredPayrollHistory" :key="receipt.id">
                                                <tr class="border-t border-slate-200">
                                                    <td class="p-3 text-center">
                                                        <input type="checkbox" :value="receipt.id" x-model="selectedReceipts" class="rounded border-slate-300">
                                                    </td>
                                                    <td class="p-3" x-text="receipt.period"></td>
                                                    <td class="p-3" x-text="receipt.payDate"></td>
                                                    <td class="p-3">
                                                        <span class="px-2 py-1 text-xs font-semibold rounded-full"
                                                            :class="{
                                                                'bg-green-100 text-green-800': receipt.status === 'Timbrado',
                                                                'bg-red-100 text-red-800': receipt.status === 'Cancelado'
                                                            }"
                                                            x-text="receipt.status">
                                                        </span>
                                                    </td>
                                                    <td class="p-3 text-right font-mono" x-text="receipt.netAmount"></td>
                                                    <td class="p-3" x-data="{ open: false }">
                                                        <div class="relative flex justify-center">
                                                            <button @click="open = !open" class="p-2 text-slate-500 hover:text-blue-600"><i data-lucide="more-vertical" class="w-5 h-5"></i></button>
                                                            <div x-show="open" @click.outside="open = false" x-transition class="absolute z-10 right-0 mt-10 w-48 bg-white rounded-md shadow-lg border border-slate-200">
                                                                <a href="#" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Descargar PDF</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Descargar XML</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Descargar .ZIP</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Ir a la nómina</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña: Deducciones y créditos -->
                        <div id="creditos" class="content-section">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <h2 class="text-lg font-bold text-slate-800 flex items-center mb-6">
                                    <i data-lucide="credit-card" class="w-6 h-6 mr-3 text-blue-600"></i>
                                    Deducciones y Créditos
                                </h2>
                                
                                <!-- Tarjetas de Resumen de Créditos Activos -->
                                <div class="overflow-x-auto custom-scrollbar pb-4 mb-8">
                                    <div class="flex gap-6 min-w-max">
                                    <!-- Tarjeta INFONAVIT -->
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 flex-shrink-0 w-80 min-w-[320px]">
                                        <div class="flex justify-between items-start mb-3">
                                            <h3 class="font-semibold text-blue-900">Crédito INFONAVIT</h3>
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Activo</span>
                                        </div>
                                        <div class="space-y-3 text-sm">
                                            <div><span class="text-blue-700 font-medium">Número:</span> INF-2024-001234</div>
                                            <div><span class="text-blue-700 font-medium">Monto Original:</span> $450,000.00</div>
                                            <div><span class="text-blue-700 font-medium">Saldo Actual:</span> $385,250.00</div>
                                            <div><span class="text-blue-700 font-medium">Descuento Mensual:</span> <span class="font-bold text-red-600">$2,850.00</span></div>
                                            <div><span class="text-blue-700 font-medium">Fecha Inicio:</span> 15/01/2024</div>
                                        </div>
                                        <div class="flex flex-wrap gap-2 mt-5">
                                            <button class="bg-blue-600 text-white px-3 py-1.5 rounded text-xs font-semibold hover:bg-blue-700 transition">Editar</button>
                                        </div>
                                    </div>
                                    
                                    <!-- Tarjeta FONACOT -->
                                    <div class="bg-green-50 border border-green-200 rounded-lg p-6 flex-shrink-0 w-80 min-w-[320px]">
                                        <div class="flex justify-between items-start mb-3">
                                            <h3 class="font-semibold text-green-900">Crédito FONACOT</h3>
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Activo</span>
                                        </div>
                                        <div class="space-y-3 text-sm">
                                            <div><span class="text-green-700 font-medium">Número:</span> FON-2024-567890</div>
                                            <div><span class="text-green-700 font-medium">Monto Original:</span> $25,000.00</div>
                                            <div><span class="text-green-700 font-medium">Saldo Actual:</span> $18,750.00</div>
                                            <div><span class="text-green-700 font-medium">Descuento Mensual:</span> <span class="font-bold text-red-600">$1,250.00</span></div>
                                            <div><span class="text-green-700 font-medium">Fecha Inicio:</span> 10/03/2024</div>
                                        </div>
                                        <div class="flex flex-wrap gap-2 mt-5">
                                            <button class="bg-green-600 text-white px-3 py-1.5 rounded text-xs font-semibold hover:bg-green-700 transition">Editar</button>
                                        </div>
                                    </div>
                                    
                                    <!-- Tarjeta Pensión -->
                                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-6 flex-shrink-0 w-80 min-w-[320px]">
                                        <div class="flex justify-between items-start mb-3">
                                            <h3 class="font-semibold text-purple-900">Pensión Alimenticia</h3>
                                        </div>
                                        <div class="space-y-3 text-sm">
                                            <div><span class="text-purple-700 font-medium">Beneficiario:</span> María Sánchez López</div>
                                            <div><span class="text-purple-700 font-medium">Parentesco:</span> Ex-cónyuge</div>
                                            <div><span class="text-purple-700 font-medium">Porcentaje:</span> 30%</div>
                                            <div><span class="text-purple-700 font-medium">Descuento Mensual:</span> <span class="font-bold text-red-600">$4,500.00</span></div>
                                            <div><span class="text-purple-700 font-medium">Fecha Inicio:</span> 01/06/2023</div>
                                        </div>
                                        <div class="flex flex-wrap gap-2 mt-5">
                                            <button class="bg-purple-600 text-white px-3 py-1.5 rounded text-xs font-semibold hover:bg-purple-700 transition">Editar</button>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </div>

                                <!-- Filtros de Categoría con Botones -->
                                <div class="flex flex-wrap gap-2 mb-6">
                                    <button @click="creditFilter = 'todos'" 
                                            :class="creditFilter === 'todos' ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'"
                                            class="px-4 py-2 rounded-lg text-sm font-semibold transition">
                                        Todos
                                    </button>
                                    <button @click="creditFilter = 'INFONAVIT'" 
                                            :class="creditFilter === 'INFONAVIT' ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'"
                                            class="px-4 py-2 rounded-lg text-sm font-semibold transition">
                                        INFONAVIT
                                    </button>
                                    <button @click="creditFilter = 'FONACOT'" 
                                            :class="creditFilter === 'FONACOT' ? 'bg-green-600 text-white' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'"
                                            class="px-4 py-2 rounded-lg text-sm font-semibold transition">
                                        FONACOT
                                    </button>
                                    <button @click="creditFilter = 'Pensión'" 
                                            :class="creditFilter === 'Pensión' ? 'bg-purple-600 text-white' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'"
                                            class="px-4 py-2 rounded-lg text-sm font-semibold transition">
                                        Pensión
                                    </button>
                                    <button @click="creditFilter = 'Terceros'" 
                                            :class="creditFilter === 'Terceros' ? 'bg-orange-600 text-white' : 'bg-slate-200 text-slate-700 hover:bg-slate-300'"
                                            class="px-4 py-2 rounded-lg text-sm font-semibold transition">
                                        Terceros
                                    </button>
                                </div>

                                <!-- Listado de Eventos Históricos -->
                                <div class="bg-slate-50 rounded-lg p-4">
                                    <h3 class="font-semibold text-slate-800 mb-4 flex items-center">
                                        <i data-lucide="history" class="w-5 h-5 mr-2 text-slate-600"></i>
                                        Historial de Eventos
                                        <span class="ml-2 px-2 py-1 text-xs bg-slate-200 text-slate-600 rounded-full" x-text="`${filteredEventosCreditos.length} eventos`"></span>
                                    </h3>
                                    
                                    <!-- Filtros de Fecha -->
                                    <div class="mb-4 p-4 bg-white rounded-lg border border-slate-200">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label for="eventosStartDate" class="text-xs font-semibold text-slate-600">Fecha de inicio</label>
                                                <input type="date" id="eventosStartDate" x-model="eventosFilters.startDate" @change="eventosPage = 1" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                            </div>
                                            <div>
                                                <label for="eventosEndDate" class="text-xs font-semibold text-slate-600">Fecha de fin</label>
                                                <input type="date" id="eventosEndDate" x-model="eventosFilters.endDate" @change="eventosPage = 1" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="bg-white rounded-lg overflow-hidden border border-slate-200">
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm">
                                                <thead class="text-left text-slate-500 bg-slate-100">
                                                    <tr>
                                                        <th class="p-3 font-semibold">Fecha/Hora</th>
                                                        <th class="p-3 font-semibold">Categoría</th>
                                                        <th class="p-3 font-semibold">Evento</th>
                                                        <th class="p-3 font-semibold">Tipo</th>
                                                        <th class="p-3 font-semibold">Detalle</th>
                                                        <th class="p-3 font-semibold">Usuario</th>
                                                        <th class="p-3 font-semibold text-center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template x-for="evento in paginatedEventosCreditos" :key="evento.id">
                                                        <tr class="border-t border-slate-200 hover:bg-slate-50 transition-colors">
                                                            <td class="p-3">
                                                                <div class="text-slate-900 font-medium" x-text="evento.fecha"></div>
                                                                <div class="text-slate-500 text-xs" x-text="evento.hora"></div>
                                                            </td>
                                                            <td class="p-3">
                                                                <span class="px-2 py-1 text-xs font-semibold rounded-full"
                                                                      :class="{
                                                                          'bg-blue-100 text-blue-800': evento.categoria === 'INFONAVIT',
                                                                          'bg-green-100 text-green-800': evento.categoria === 'FONACOT',
                                                                          'bg-purple-100 text-purple-800': evento.categoria === 'Pensión',
                                                                          'bg-orange-100 text-orange-800': evento.categoria === 'Terceros'
                                                                      }"
                                                                      x-text="evento.categoria">
                                                                </span>
                                                            </td>
                                                            <td class="p-3 font-semibold text-slate-800" x-text="evento.evento"></td>
                                                            <td class="p-3">
                                                                <span class="px-2 py-1 text-xs rounded-full"
                                                                      :class="{
                                                                          'bg-green-100 text-green-800': evento.tipo === 'registro',
                                                                          'bg-blue-100 text-blue-800': evento.tipo === 'aplicacion',
                                                                          'bg-yellow-100 text-yellow-800': evento.tipo === 'modificacion',
                                                                          'bg-gray-100 text-gray-800': evento.tipo === 'liquidacion',
                                                                          'bg-purple-100 text-purple-800': evento.tipo === 'abono'
                                                                      }"
                                                                      x-text="evento.tipo">
                                                                </span>
                                                            </td>
                                                            <td class="p-3 text-slate-600 max-w-md">
                                                                <div class="truncate" :title="evento.detalle" x-text="evento.detalle"></div>
                                                            </td>
                                                            <td class="p-3 text-slate-600 text-sm" x-text="evento.usuario"></td>
                                                            <td class="p-3 text-center">
                                                                <template x-if="evento.tipo === 'aplicacion'">
                                                                    <button class="text-green-600 hover:text-green-800 p-1" title="Ir a nómina">
                                                                        <i data-lucide="file-text" class="w-4 h-4"></i>
                                                                    </button>
                                                                </template>
                                                            </td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Paginación -->
                                        <div class="flex justify-between items-center p-4 border-t border-slate-200">
                                            <p class="text-sm text-slate-500" x-text="`Mostrando ${paginatedEventosCreditos.length} de ${filteredEventosCreditos.length} eventos`"></p>
                                            <div class="flex items-center space-x-1">
                                                <button @click="eventosPage = Math.max(1, eventosPage - 1)" :disabled="eventosPage === 1" class="p-2 rounded-md hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                                    <i data-lucide="chevron-left" class="w-5 h-5"></i>
                                                </button>
                                                <template x-for="page in Array.from({length: totalEventosPages}, (_, i) => i + 1)" :key="page">
                                                    <button @click="eventosPage = page" 
                                                            :class="{'bg-blue-600 text-white': eventosPage === page, 'hover:bg-slate-100': eventosPage !== page}" 
                                                            class="px-3 py-1 rounded-md text-sm font-medium" 
                                                            x-text="page">
                                                    </button>
                                                </template>
                                                <button @click="eventosPage = Math.min(totalEventosPages, eventosPage + 1)" :disabled="eventosPage === totalEventosPages" class="p-2 rounded-md hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                                    <i data-lucide="chevron-right" class="w-5 h-5"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Mensaje cuando no hay eventos -->
                                        <div x-show="filteredEventosCreditos.length === 0" class="text-center py-12 text-slate-500">
                                            <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                                            <p>No hay eventos para mostrar en la categoría seleccionada.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña: Asistencia e Incapacidades -->
                        <div id="asistencia" class="content-section">
                             <div class="bg-white p-6 rounded-lg shadow-sm">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-lg font-bold text-slate-800 flex items-center"><i data-lucide="calendar-check" class="w-6 h-6 mr-3 text-blue-600"></i>Asistencia e Incapacidades</h2>
                                    <div class="relative" x-data="{ openAbsenceDropdown: false }">
                                        <button @click="openAbsenceDropdown = !openAbsenceDropdown" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700 transition flex items-center">
                                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                            Registrar Ausencia
                                            <i data-lucide="chevron-down" class="w-4 h-4 ml-2"></i>
                                        </button>
                                        <div x-show="openAbsenceDropdown" @click.outside="openAbsenceDropdown = false" x-transition class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-slate-200 z-10">
                                            <a href="#" @click="openAbsenceDropdown = false; showInasistenciaModal = true" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 flex items-center">
                                                <i data-lucide="x-circle" class="w-4 h-4 mr-2 text-red-500"></i>
                                                Inasistencia
                                            </a>
                                            <a href="#" @click="openAbsenceDropdown = false; showIncapacidadModal = true" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 flex items-center">
                                                <i data-lucide="heart-pulse" class="w-4 h-4 mr-2 text-orange-500"></i>
                                                Incapacidad
                                            </a>
                                            <a href="#" @click="openAbsenceDropdown = false; showPermisoModal = true" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 flex items-center">
                                                <i data-lucide="clock" class="w-4 h-4 mr-2 text-blue-500"></i>
                                                Permiso
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-8 overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="text-left text-slate-500 bg-slate-50">
                                            <tr>
                                                <th class="p-3 font-semibold">Tipo</th>
                                                <th class="p-3 font-semibold">Fecha inicio</th>
                                                <th class="p-3 font-semibold">Fecha término</th>
                                                <th class="p-3 font-semibold">Días</th>
                                                <th class="p-3 font-semibold">Estado</th>
                                                <th class="p-3 font-semibold text-center">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="item in attendanceHistory" :key="item.id">
                                                <tr class="border-t border-slate-200">
                                                    <td class="p-3 font-semibold" x-text="item.type"></td>
                                                    <td class="p-3" x-text="item.startDate"></td>
                                                    <td class="p-3" x-text="item.endDate"></td>
                                                    <td class="p-3" x-text="item.days"></td>
                                                    <td class="p-3">
                                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800" x-text="item.status"></span>
                                                    </td>
                                                    <td class="p-3">
                                                        <div class="flex justify-center space-x-2 text-slate-500">
                                                            <button class="hover:text-blue-600"><i data-lucide="eye" class="w-5 h-5"></i></button>
                                                            <button class="hover:text-blue-600"><i data-lucide="pencil" class="w-5 h-5"></i></button>
                                                            <button class="hover:text-red-600"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña: Gestión de Vacaciones -->
                        <div id="vacaciones" class="content-section">
                            <div class="space-y-6">
                                <div class="bg-white p-6 rounded-lg shadow-sm">
                                    <div class="flex justify-between items-center">
                                        <h2 class="text-lg font-bold text-slate-800">Resumen de Vacaciones</h2>
                                        <div class="flex items-center space-x-2">
                                            <button @click="showPoliciesModal = true" class="bg-white border border-slate-300 text-slate-700 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 transition">Ver Prestaciones</button>
                                            <button class="bg-white border border-slate-300 text-slate-700 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 transition">Modificar Prestaciones</button>
                                        </div>
                                    </div>
                                    <!-- New Vacation Balance Layout -->
                                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                                            <p class="text-sm text-blue-800 font-semibold">Total Saldo</p>
                                            <p class="text-3xl font-bold text-blue-600 mt-1">11.0</p>
                                            <p class="text-xs text-slate-500">Días disponibles</p>
                                        </div>
                                        <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                                            <p class="text-sm text-green-800 font-semibold">Acumuladas</p>
                                            <p class="text-3xl font-bold text-green-600 mt-1">14.0</p>
                                            <p class="text-xs text-slate-500">Días ganados por ley</p>
                                        </div>
                                        <div class="bg-amber-50 border border-amber-200 p-4 rounded-lg">
                                            <p class="text-sm text-amber-800 font-semibold">Tomadas</p>
                                            <p class="text-3xl font-bold text-amber-600 mt-1">1.0</p>
                                            <p class="text-xs text-slate-500">Días ya disfrutados</p>
                                        </div>
                                        <div class="bg-red-50 border border-red-200 p-4 rounded-lg">
                                            <p class="text-sm text-red-800 font-semibold">Vencidas</p>
                                            <p class="text-3xl font-bold text-red-600 mt-1">2.0</p>
                                            <p class="text-xs text-slate-500">Periodos expirados</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Vacaciones Tomadas -->
                                <div class="bg-white p-6 rounded-lg shadow-sm">
                                    <div class="flex justify-between items-center">
                                        <h2 class="text-lg font-bold text-slate-800">Historial de Vacaciones Tomadas</h2>
                                        <button @click="showAddVacationModal = true" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700 transition flex items-center">
                                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>Agregar
                                        </button>
                                    </div>
                                    <div class="mt-4 overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead class="text-left text-slate-500 bg-slate-50">
                                                <tr>
                                                    <th class="p-3 font-semibold">Inicio</th>
                                                    <th class="p-3 font-semibold">Término</th>
                                                    <th class="p-3 font-semibold">Número de Días</th>
                                                    <th class="p-3 font-semibold">Tipo</th>
                                                    <th class="p-3 font-semibold">Estado</th>
                                                    <th class="p-3 font-semibold">Opciones</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="border-t border-slate-200">
                                                    <td class="p-3">11-09-2025</td>
                                                    <td class="p-3">11-09-2025</td>
                                                    <td class="p-3">1.0</td>
                                                    <td class="p-3">Legales</td>
                                                    <td class="p-3"><span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Aprobada</span></td>
                                                    <td class="p-3">
                                                        <div class="flex space-x-2 text-slate-500">
                                                            <button class="hover:text-blue-600"><i data-lucide="eye" class="w-5 h-5"></i></button>
                                                            <button class="hover:text-blue-600"><i data-lucide="pencil" class="w-5 h-5"></i></button>
                                                            <button class="hover:text-red-600"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                         <!-- Pestaña: Expediente Digital -->
                        <div id="documentos" class="content-section">
                             <div class="bg-white p-6 rounded-lg shadow-sm">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-lg font-bold text-slate-800 flex items-center"><i data-lucide="folder-archive" class="w-6 h-6 mr-3 text-blue-600"></i>Expediente Digital</h2>
                                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700 transition flex items-center">
                                        <i data-lucide="upload" class="w-4 h-4 mr-2"></i>Subir archivo
                                    </button>
                                </div>
                                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <template x-for="doc in digitalFile">
                                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 flex items-center justify-between">
                                            <div class="flex items-center">
                                                <i data-lucide="file-text" class="w-5 h-5 mr-3 text-slate-500"></i>
                                                <span class="text-sm font-semibold" x-text="doc.name"></span>
                                            </div>
                                            <button class="p-1 text-slate-400 hover:text-blue-600"><i data-lucide="download" class="w-5 h-5"></i></button>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña: Auditoría -->
                        <div id="auditoria" class="content-section">
                            <!-- Sub-navegación de pestañas para Auditoría -->
                            <nav class="border-b border-slate-200 mb-6">
                                <div class="flex space-x-8">
                                    <template x-for="tab in auditTabs" :key="tab.id">
                                        <button @click="activeAuditTab = tab.id" 
                                                :class="activeAuditTab === tab.id ? 'profile-tab-active' : 'profile-tab-inactive'" 
                                                class="py-3 px-1 text-sm transition-colors duration-200" 
                                                x-text="tab.name">
                                        </button>
                                    </template>
                                </div>
                            </nav>

                            <!-- Contenido de las sub-pestañas -->
                            <div>
                                <!-- Histórico -->
                                <div x-show="activeAuditTab === 'historico'">
                                    <div class="bg-white p-6 rounded-lg shadow-sm">
                                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                                            <i data-lucide="history" class="w-5 h-5 mr-3 text-blue-600"></i>
                                            Histórico de Modificaciones
                                        </h3>
                                        <!-- Filtros -->
                                        <div class="mb-4 p-4 bg-slate-50 rounded-lg border border-slate-200">
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label for="historicoStartDate" class="text-xs font-semibold text-slate-600">Fecha de inicio</label>
                                                    <input type="date" id="historicoStartDate" x-model="historicoFilters.startDate" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                                </div>
                                                <div>
                                                    <label for="historicoEndDate" class="text-xs font-semibold text-slate-600">Fecha de fin</label>
                                                    <input type="date" id="historicoEndDate" x-model="historicoFilters.endDate" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                                </div>
                                                <div>
                                                    <label for="historicoUsuario" class="text-xs font-semibold text-slate-600">Usuario</label>
                                                    <select id="historicoUsuario" x-model="historicoFilters.usuario" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                                        <option value="all">Todos los usuarios</option>
                                                        <option value="Eduardo Castillo">Eduardo Castillo</option>
                                                        <option value="Laura Méndez">Laura Méndez</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm">
                                                <thead class="text-left text-slate-500 bg-slate-50">
                                                    <tr>
                                                        <th class="p-3 font-semibold">Campo modificado</th>
                                                        <th class="p-3 font-semibold">Valor actualizado</th>
                                                        <th class="p-3 font-semibold">Valor anterior</th>
                                                        <th class="p-3 font-semibold">Usuario</th>
                                                        <th class="p-3 font-semibold">Fecha</th>
                                                        <th class="p-3 font-semibold">Hora</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template x-for="item in filteredHistoricoData" :key="item.id">
                                                        <tr class="border-t border-slate-200">
                                                            <td class="p-3 font-semibold" x-text="item.campo"></td>
                                                            <td class="p-3 text-green-600 font-medium" x-text="item.valorActualizado"></td>
                                                            <td class="p-3 text-slate-500" x-text="item.valorAnterior"></td>
                                                            <td class="p-3" x-text="item.usuario"></td>
                                                            <td class="p-3" x-text="item.fecha"></td>
                                                            <td class="p-3" x-text="item.hora"></td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- Acciones de usuario -->
                                <div x-show="activeAuditTab === 'acciones'">
                                    <div class="bg-white p-6 rounded-lg shadow-sm">
                                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                                            <i data-lucide="shield-check" class="w-5 h-5 mr-3 text-blue-600"></i>
                                            Registro de Acciones de Usuario
                                        </h3>
                                        
                                        <!-- Filtros -->
                                        <div class="mb-4 p-4 bg-slate-50 rounded-lg border border-slate-200">
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div>
                                                    <label for="auditStartDate" class="text-xs font-semibold text-slate-600">Fecha de inicio</label>
                                                    <input type="date" id="auditStartDate" x-model="auditFilters.startDate" @change="auditLogPage = 1" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                                </div>
                                                <div>
                                                    <label for="auditEndDate" class="text-xs font-semibold text-slate-600">Fecha de fin</label>
                                                    <input type="date" id="auditEndDate" x-model="auditFilters.endDate" @change="auditLogPage = 1" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                                </div>
                                                <div>
                                                    <label for="auditDescription" class="text-xs font-semibold text-slate-600">Búsqueda por descripción</label>
                                                    <input type="text" id="auditDescription" x-model="auditFilters.description" @input="auditLogPage = 1" placeholder="Buscar en descripción..." class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm">
                                                <thead class="text-left text-slate-500 bg-slate-50">
                                                    <tr>
                                                        <th class="p-3 font-semibold">Descripción</th>
                                                        <th class="p-3 font-semibold">Nombre usuario</th>
                                                        <th class="p-3 font-semibold">Rol de usuario</th>
                                                        <th class="p-3 font-semibold">Fecha</th>
                                                        <th class="p-3 font-semibold">Hora</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template x-for="log in paginatedAuditLog" :key="log.id">
                                                        <tr class="border-t border-slate-200">
                                                            <td class="p-3" x-text="log.description"></td>
                                                            <td class="p-3" x-text="log.user"></td>
                                                            <td class="p-3"><span class="px-2 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-700" x-text="log.role"></span></td>
                                                            <td class="p-3" x-text="log.date"></td>
                                                            <td class="p-3" x-text="log.time"></td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- Pagination -->
                                        <div class="mt-4 flex justify-between items-center text-sm">
                                            <p class="text-slate-500" x-text="`Mostrando ${paginatedAuditLog.length} de ${filteredAuditLog.length} registros`"></p>
                                            <div class="flex items-center space-x-1">
                                                <button @click="auditLogPage = Math.max(1, auditLogPage - 1)" :disabled="auditLogPage === 1" class="p-2 rounded-md hover:bg-slate-100 disabled:opacity-50"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                                                <template x-for="page in totalAuditPages">
                                                    <button @click="auditLogPage = page" :class="{'bg-blue-600 text-white': auditLogPage === page, 'hover:bg-slate-100': auditLogPage !== page}" class="px-3 py-1 rounded-md" x-text="page"></button>
                                                </template>
                                                <button @click="auditLogPage = Math.min(totalAuditPages, auditLogPage + 1)" :disabled="auditLogPage === totalAuditPages" class="p-2 rounded-md hover:bg-slate-100 disabled:opacity-50"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Policies Modal -->
            <div x-show="showPoliciesModal" @keydown.escape.window="showPoliciesModal = false" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50" x-transition>
                <div @click.outside="showPoliciesModal = false" class="bg-white rounded-lg shadow-xl w-full max-w-3xl">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800">Políticas de Vacaciones del Colaborador</h3>
                        <button @click="showPoliciesModal = false" class="text-slate-500 hover:text-slate-800">&times;</button>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="text-sm font-semibold text-slate-600">Periodo</label>
                                <input type="text" value="1° Quincena, Julio '25" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm" disabled>
                            </div>
                            <div>
                                <label class="text-sm font-semibold text-slate-600">Ver Tipo de Vacaciones</label>
                                <select class="mt-1 block w-full rounded-md border-slate-300 shadow-sm text-sm">
                                    <option>Legales</option>
                                </select>
                            </div>
                        </div>
                        <h4 class="font-bold text-slate-700 mb-2">Legal 2023</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="text-left text-slate-500 bg-slate-50">
                                    <tr>
                                        <th class="p-3 font-semibold">Años de antigüedad</th>
                                        <th class="p-3 font-semibold">Días de vacaciones</th>
                                        <th class="p-3 font-semibold">Prima Vacacional</th>
                                        <th class="p-3 font-semibold">Días de Aguinaldo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template x-for="policy in vacationPolicies">
                                        <tr class="border-t border-slate-200">
                                            <td class="p-3" x-text="policy.years"></td>
                                            <td class="p-3" x-text="policy.days"></td>
                                            <td class="p-3" x-text="policy.prima"></td>
                                            <td class="p-3" x-text="policy.aguinaldo"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Vacation Modal -->
            <div x-show="showAddVacationModal" @keydown.escape.window="showAddVacationModal = false" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50" x-transition>
                <div @click.outside="showAddVacationModal = false" class="bg-white rounded-lg shadow-xl w-full max-w-2xl">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800">Tomar Vacaciones</h3>
                        <button @click="showAddVacationModal = false" class="text-slate-500 hover:text-slate-800 text-2xl">&times;</button>
                    </div>
                    <div class="p-6">
                        <!-- Días disponibles -->
                        <div class="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center">
                            <i data-lucide="palm-tree" class="w-5 h-5 text-green-600 mr-2"></i>
                            <span class="text-green-800 font-semibold">11.0 días totales disponibles</span>
                        </div>

                        <form @submit.prevent="console.log('Guardar vacación')">
                            <!-- Información de días disponibles -->
                            <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center">
                                <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-2"></i>
                                <span class="text-blue-800 text-sm">Tienes <strong>11.0 días</strong> disponibles.</span>
                            </div>

                            <!-- Fechas -->
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha de inicio <span class="text-red-500">*</span></label>
                                    <input type="date" x-model="newVacation.startDate" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha de término <span class="text-red-500">*</span></label>
                                    <input type="date" x-model="newVacation.endDate" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                </div>
                            </div>

                            <!-- Periodo de última vacación -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Periodo de la última vacación <span class="text-red-500">*</span></label>
                                <input type="text" x-model="newVacation.lastVacationPeriod" class="w-full rounded-md border-slate-300 shadow-sm text-sm" value="15/06/2025 al 21/06/2025" required readonly>
                            </div>

                            <!-- Checkboxes -->
                            <div class="mb-4 space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="newVacation.hasReplacement" class="rounded border-slate-300 mr-2">
                                    <span class="text-sm text-slate-700">Asignar reemplazo o suplencia</span>
                                </label>
                            </div>

                            <!-- Colaborador suplente -->
                            <div x-show="newVacation.hasReplacement" class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Colaborador Suplente</label>
                                <select x-model="newVacation.replacementEmployee" class="w-full rounded-md border-slate-300 shadow-sm text-sm">
                                    <option value="">Seleccionar colaborador...</option>
                                    <option value="Victoria Castro Rojas (F1)">Victoria Castro Rojas (F1)</option>
                                    <option value="Juan Pérez (F2)">Juan Pérez (F2)</option>
                                    <option value="María García (F3)">María García (F3)</option>
                                </select>
                            </div>

                            <!-- Información de días solicitados -->
                            <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center" x-show="vacationDays > 0">
                                <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-2"></i>
                                <span class="text-blue-800 text-sm">Estás solicitando <strong x-text="vacationDays"></strong> días laborales de vacaciones</span>
                            </div>

                            <!-- Comentario -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Comentario</label>
                                <textarea x-model="newVacation.comments" rows="3" class="w-full rounded-md border-slate-300 shadow-sm text-sm" placeholder="Agregar comentarios adicionales..."></textarea>
                            </div>

                            <!-- Botones -->
                            <div class="flex justify-end space-x-3">
                                <button type="button" @click="showAddVacationModal = false" class="px-4 py-2 text-sm font-semibold text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition">
                                    Cancelar
                                </button>
                                <button type="submit" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition">
                                    Guardar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Registrar Inasistencia Modal -->
            <div x-show="showInasistenciaModal" @keydown.escape.window="showInasistenciaModal = false" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50" x-transition>
                <div @click.outside="showInasistenciaModal = false" class="bg-white rounded-lg shadow-xl w-full max-w-2xl">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800">Registrar Inasistencia</h3>
                        <button @click="showInasistenciaModal = false" class="text-slate-500 hover:text-slate-800 text-2xl">&times;</button>
                    </div>
                    <div class="p-6">
                        <form @submit.prevent="console.log('Guardar inasistencia')">
                            <!-- Tipo de Asistencia -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Tipo de Asistencia <span class="text-red-500">*</span></label>
                                <select x-model="newInasistencia.tipo" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                    <option value="Inasistencia">Inasistencia</option>
                                </select>
                            </div>

                            <!-- Fechas -->
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha Inicio <span class="text-red-500">*</span></label>
                                    <input type="date" x-model="newInasistencia.fechaInicio" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha Término <span class="text-red-500">*</span></label>
                                    <input type="date" x-model="newInasistencia.fechaTermino" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                </div>
                            </div>

                            <!-- Inicio Fecha Aplicación -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Inicio Fecha Aplicación</label>
                                <input type="date" x-model="newInasistencia.inicioFechaAplicacion" class="w-full rounded-md border-slate-300 shadow-sm text-sm">
                            </div>

                            <!-- Activar Suplencia -->
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="newInasistencia.activarSuplencia" class="rounded border-slate-300 mr-2">
                                    <span class="text-sm text-slate-700">Activar Suplencia</span>
                                </label>
                            </div>

                            <!-- Colaborador Suplente -->
                            <div x-show="newInasistencia.activarSuplencia" class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Colaborador Suplente</label>
                                <select x-model="newInasistencia.colaboradorSuplente" class="w-full rounded-md border-slate-300 shadow-sm text-sm">
                                    <option value="">Seleccionar colaborador...</option>
                                    <option value="Ana Eugenia Reyes Castellanos (F1)">Ana Eugenia Reyes Castellanos (F1)</option>
                                    <option value="Victoria Castro Rojas (F1)">Victoria Castro Rojas (F1)</option>
                                    <option value="Juan Pérez (F2)">Juan Pérez (F2)</option>
                                    <option value="María García (F3)">María García (F3)</option>
                                </select>
                            </div>

                            <!-- Información de días calculados -->
                            <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center" x-show="inasistenciaDays > 0">
                                <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-2"></i>
                                <span class="text-blue-800 text-sm">Estás registrando <strong x-text="inasistenciaDays"></strong> días de inasistencia</span>
                            </div>

                            <!-- Comentario -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Comentario</label>
                                <textarea x-model="newInasistencia.comentario" rows="3" class="w-full rounded-md border-slate-300 shadow-sm text-sm" placeholder="No se presentó explicó que tuvo una emergencia familiar."></textarea>
                            </div>

                            <!-- Botones -->
                            <div class="flex justify-end space-x-3">
                                <button type="button" @click="showInasistenciaModal = false" class="px-4 py-2 text-sm font-semibold text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition">
                                    Cancelar
                                </button>
                                <button type="submit" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition">
                                    Agregar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Registrar Permiso Modal -->
            <div x-show="showPermisoModal" @keydown.escape.window="showPermisoModal = false" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50" x-transition>
                <div @click.outside="showPermisoModal = false" class="bg-white rounded-lg shadow-xl w-full max-w-2xl">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800">Registrar Permisos</h3>
                        <button @click="showPermisoModal = false" class="text-slate-500 hover:text-slate-800 text-2xl">&times;</button>
                    </div>
                    <div class="p-6">
                        <form @submit.prevent="console.log('Guardar permiso')">
                            <!-- Tipo de Asistencia -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Tipo de Asistencia <span class="text-red-500">*</span></label>
                                <select x-model="newPermiso.tipo" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                    <option value="Permiso">Permiso</option>
                                </select>
                            </div>

                            <!-- Subtipo de Permiso -->
                            <div class="mb-4">
                                <p class="text-sm text-blue-600 font-medium">Permiso sin goce de sueldo</p>
                            </div>

                            <!-- Fechas -->
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha Inicio <span class="text-red-500">*</span></label>
                                    <input type="date" x-model="newPermiso.fechaInicio" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha Término <span class="text-red-500">*</span></label>
                                    <input type="date" x-model="newPermiso.fechaTermino" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                </div>
                            </div>

                            <!-- Inicio Fecha Aplicación -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Inicio Fecha Aplicación</label>
                                <input type="date" x-model="newPermiso.inicioFechaAplicacion" class="w-full rounded-md border-slate-300 shadow-sm text-sm">
                            </div>

                            <!-- Activar Suplencia -->
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" x-model="newPermiso.activarSuplencia" class="rounded border-slate-300 mr-2">
                                    <span class="text-sm text-slate-700">Activar Suplencia</span>
                                </label>
                            </div>

                            <!-- Colaborador Suplente -->
                            <div x-show="newPermiso.activarSuplencia" class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Colaborador Suplente</label>
                                <select x-model="newPermiso.colaboradorSuplente" class="w-full rounded-md border-slate-300 shadow-sm text-sm">
                                    <option value="">Seleccionar colaborador...</option>
                                    <option value="Ana Prueba X (F1)">Ana Prueba X (F1)</option>
                                    <option value="Victoria Castro Rojas (F1)">Victoria Castro Rojas (F1)</option>
                                    <option value="Juan Pérez (F2)">Juan Pérez (F2)</option>
                                    <option value="María García (F3)">María García (F3)</option>
                                </select>
                            </div>

                            <!-- Información de días calculados -->
                            <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center" x-show="permisoDays > 0">
                                <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-2"></i>
                                <span class="text-blue-800 text-sm">Estás registrando <strong x-text="permisoDays"></strong> días de permiso</span>
                            </div>

                            <!-- Comentario -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Comentario</label>
                                <textarea x-model="newPermiso.comentario" rows="3" class="w-full rounded-md border-slate-300 shadow-sm text-sm" placeholder="Permiso de ausencia por festival de su hijo"></textarea>
                            </div>

                            <!-- Botones -->
                            <div class="flex justify-end space-x-3">
                                <button type="button" @click="showPermisoModal = false" class="px-4 py-2 text-sm font-semibold text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition">
                                    Cancelar
                                </button>
                                <button type="submit" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition">
                                    Agregar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                        </div>

            <!-- Registrar Incapacidad Modal -->
            <div x-show="showIncapacidadModal" @keydown.escape.window="showIncapacidadModal = false" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50" x-transition>
                <div @click.outside="showIncapacidadModal = false" class="bg-white rounded-lg shadow-xl w-full max-w-3xl">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800">Registrar Incapacidad</h3>
                        <button @click="showIncapacidadModal = false" class="text-slate-500 hover:text-slate-800 text-2xl">&times;</button>
                    </div>
                    <div class="p-6">
                        <form @submit.prevent="console.log('Guardar incapacidad')">
                            <!-- Buscar Trabajador y Número de Incapacidad -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Buscar Trabajador <span class="text-red-500">*</span></label>
                                    <input type="text" 
                                           x-model="newIncapacidad.trabajadorSearch" 
                                           @input="newIncapacidad.showTrabajadorDropdown = true"
                                           @focus="newIncapacidad.showTrabajadorDropdown = true"
                                           class="w-full rounded-md border-slate-300 shadow-sm text-sm" 
                                           placeholder="Escribe para buscar..." 
                                           autocomplete="off" 
                                           required>
                                    <input type="hidden" x-model="newIncapacidad.trabajadorId">
                                    
                                    <!-- Dropdown de resultados -->
                                    <div x-show="newIncapacidad.showTrabajadorDropdown && filteredTrabajadores.length > 0" 
                                         @click.outside="newIncapacidad.showTrabajadorDropdown = false"
                                         class="absolute z-10 w-full bg-white border border-slate-300 rounded-md mt-1 shadow-lg max-h-60 overflow-y-auto">
                                        <template x-for="trabajador in filteredTrabajadores" :key="trabajador.id">
                                            <div @click="selectTrabajador(trabajador)" 
                                                 class="px-4 py-3 hover:bg-slate-100 cursor-pointer border-b border-slate-100 last:border-b-0">
                                                <div class="font-medium text-slate-800" x-text="trabajador.nombre"></div>
                                                <div class="text-sm text-slate-500">
                                                    <span x-text="trabajador.puesto"></span> • <span x-text="trabajador.departamento"></span>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                    
                                    <!-- Mensaje cuando no hay resultados -->
                                    <div x-show="newIncapacidad.showTrabajadorDropdown && newIncapacidad.trabajadorSearch.length >= 2 && filteredTrabajadores.length === 0"
                                         class="absolute z-10 w-full bg-white border border-slate-300 rounded-md mt-1 shadow-lg">
                                        <div class="px-4 py-3 text-slate-500 text-sm">
                                            No se encontraron trabajadores
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Número de Incapacidad (Folio) <span class="text-red-500">*</span></label>
                                    <input type="text" x-model="newIncapacidad.numeroIncapacidad" class="w-full rounded-md border-slate-300 shadow-sm text-sm" placeholder="Ej: AB123456" pattern="[A-Za-z]{2}[0-9]{6}" required>
                                    <p class="text-red-500 text-xs mt-1">Formato: 2 letras y 6 números</p>
                                </div>
                            </div>

                            <!-- Tipo de Incapacidad y Subtipo -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Tipo de Incapacidad IMSS <span class="text-red-500">*</span></label>
                                    <select x-model="newIncapacidad.tipoIncapacidad" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                        <option value="Enfermedad General">Enfermedad General</option>
                                        <option value="Maternidad">Maternidad</option>
                                        <option value="Riesgo de Trabajo">Riesgo de Trabajo</option>
                                    </select>
                                </div>
                                <div x-show="newIncapacidad.tipoIncapacidad === 'Riesgo de Trabajo'">
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Subtipo de Riesgo <span class="text-red-500">*</span></label>
                                    <select x-model="newIncapacidad.subtipoRiesgo" class="w-full rounded-md border-slate-300 shadow-sm text-sm">
                                        <option value="Accidente de Trabajo">Accidente de Trabajo</option>
                                        <option value="Accidente en Trayecto">Accidente en Trayecto</option>
                                        <option value="Enfermedad de Trabajo">Enfermedad de Trabajo</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Fechas y Días -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha de Inicio <span class="text-red-500">*</span></label>
                                    <input type="date" x-model="newIncapacidad.fechaInicio" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Días <span class="text-red-500">*</span></label>
                                    <input type="number" x-model="newIncapacidad.diasIncapacidad" min="1" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha de Término</label>
                                    <input type="date" :value="calculatedEndDate" class="w-full rounded-md border-slate-300 shadow-sm text-sm bg-slate-100" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Fecha Expedición</label>
                                    <input type="date" x-model="newIncapacidad.fechaExpedicion" class="w-full rounded-md border-slate-300 shadow-sm text-sm">
                                </div>
                            </div>

                            <!-- Modo de Incapacidad -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Modo de Incapacidad <span class="text-red-500">*</span></label>
                                <select x-model="newIncapacidad.modoIncapacidad" class="w-full rounded-md border-slate-300 shadow-sm text-sm" required>
                                    <option value="Inicial">Inicial</option>
                                    <option value="Subsecuente">Subsecuente</option>
                                    <option value="Unica">Única</option>
                                </select>
                            </div>

                            <!-- Advertencia de Nómina (condicional) -->
                            <div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg flex items-center" x-show="false">
                                <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-600 mr-2"></i>
                                <div>
                                    <span class="font-medium text-yellow-800">¡Advertencia!</span>
                                    <div class="text-yellow-700 text-sm mt-1">
                                        El rango de fechas se cruza con un periodo de nómina ya autorizado.
                                    </div>
                                </div>
                            </div>

                            <!-- Botones -->
                            <div class="flex justify-end space-x-3 pt-4 border-t border-slate-200">
                                <button type="button" @click="showIncapacidadModal = false" class="px-4 py-2 text-sm font-semibold text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition">
                                    Cancelar
                                </button>
                                <button type="submit" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition">
                                    Guardar Incapacidad
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>
</html>
